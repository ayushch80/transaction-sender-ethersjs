<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>CREATE TXN!</title>
  </head>
  <body>
    <div>
      <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
        <div class="container-md">
          <a class="navbar-brand" href="https://github.com/ayushch80/">ayushch80</a>
        </div>
      </nav>
    </div>
    <div>
      <h5 id="userAdd">Your Metamask Wallet isn't connected</h5>
      <div>
        <form id="uData" method="POST">
          <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">Receivers Address</span>
            <input type="text" class="form-control" placeholder="Enter Receivers Address" aria-label="rAdd" aria-describedby="basic-addon1" id="add">
          </div>
          <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">Amount (in ETH)</span>
            <input type="text" class="form-control" placeholder="Enter Amount" aria-label="rAdd" aria-describedby="basic-addon1" id="amo">
          </div>
          <div class="col-12">
            <button name="data" type="button" class="btn btn-primary" id="btn_click">Submit Transaction</button>
          </div>
        </form>
      </div>
      <h5 id="_hash"></h5>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" crossorigin="anonymous"></script>
    <script type="module">
      const provider = new ethers.providers.Web3Provider(window.ethereum, "any")
      await provider.send("eth_requestAccounts", []);
      const signer = provider.getSigner()
      var userAddress = await signer.getAddress();
      document.getElementById("userAdd").innerText = "Your Address is " + userAddress;
      provider.on("network", (newNetwork, oldNetwork) => {
        if (oldNetwork) {
            window.location.reload();
        }
      });
      document.getElementById("btn_click").addEventListener("click", getData);
      async function getData() {
        const bData = document.getElementById("uData");
        const rAdd = bData.elements.namedItem("add").value;
        const rAmo = bData.elements.namedItem("amo").value;
        let txn = signer.sendTransaction({ to: rAdd, value: ethers.utils.parseEther(rAmo)});
        let tx = await txn;
        document.getElementById("_hash").innerText = "Transaction Hash : " + tx.hash;
        let receipt = await tx.wait();
        document.getElementById("_hash").innerText = "Transaction is confirmed at hash " + tx.hash;
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  </body>
</html>
